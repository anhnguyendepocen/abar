<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced Business Analytics with R: Descriptive, Predictive, and Prescriptive Methods</title>
  <meta name="description" content="A deep-dive into using R for descriptive, predictive, and prescriptive analytics.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced Business Analytics with R: Descriptive, Predictive, and Prescriptive Methods" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A deep-dive into using R for descriptive, predictive, and prescriptive analytics." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced Business Analytics with R: Descriptive, Predictive, and Prescriptive Methods" />
  
  <meta name="twitter:description" content="A deep-dive into using R for descriptive, predictive, and prescriptive analytics." />
  

<meta name="author" content="Bradley C. Boehmke and Brandon M. Greenwell">


<meta name="date" content="2018-07-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro.html">
<link rel="next" href="inference.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="extra.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Business Analytics with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-for"><i class="fa fa-check"></i>Who this book is for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-not-for"><i class="fa fa-check"></i>Who this book is not for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-really-not-for"><i class="fa fa-check"></i>Who this book is really not for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i>Why R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-this-book-is-organized"><i class="fa fa-check"></i>How this book is organized</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions-used-in-this-book"><i class="fa fa-check"></i>Conventions used in this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#using-code-examples"><i class="fa fa-check"></i>Using code examples</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#feedback"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-information"><i class="fa fa-check"></i>Software information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>Who are these Guys?</a><ul>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#bradley-c.-boehmke"><i class="fa fa-check"></i>Bradley C. Boehmke</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html#brandon-m.-greenwell"><i class="fa fa-check"></i>Brandon M. Greenwell</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#descriptive"><i class="fa fa-check"></i><b>1.1</b> Descriptive</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#predictive"><i class="fa fa-check"></i><b>1.2</b> Predictive</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#prescriptive"><i class="fa fa-check"></i><b>1.3</b> Prescriptive</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#data-sets"><i class="fa fa-check"></i><b>1.4</b> Data sets</a><ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#ames-iowa-housing-data"><i class="fa fa-check"></i>Ames Iowa housing data</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#employee-attrition-data"><i class="fa fa-check"></i>Employee attrition data</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I Descriptive Analytics</b></span><ul>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#prerequisites"><i class="fa fa-check"></i><b>1.5</b> Prerequisites</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#measures-of-location"><i class="fa fa-check"></i><b>1.6</b> Measures of location</a><ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#the-sample-mean"><i class="fa fa-check"></i><b>1.6.1</b> The sample mean</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#the-sample-median"><i class="fa fa-check"></i><b>1.6.2</b> The sample median</a></li>
<li class="chapter" data-level="1.6.3" data-path="intro.html"><a href="intro.html#the-mean-or-the-median"><i class="fa fa-check"></i><b>1.6.3</b> The mean or the median</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#measures-of-spread"><i class="fa fa-check"></i><b>1.7</b> Measures of spread</a><ul>
<li class="chapter" data-level="1.7.1" data-path="intro.html"><a href="intro.html#empirical-rule"><i class="fa fa-check"></i><b>1.7.1</b> The empirical rule</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#percentiles"><i class="fa fa-check"></i><b>1.8</b> Percentiles</a></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#robust-measures-of-spread"><i class="fa fa-check"></i><b>1.9</b> Robust measures of spread</a></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#outliers"><i class="fa fa-check"></i><b>1.10</b> Outlier detection</a></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#categorical"><i class="fa fa-check"></i><b>1.11</b> Describing categorical data</a><ul>
<li class="chapter" data-level="1.11.1" data-path="intro.html"><a href="intro.html#contingency-tables"><i class="fa fa-check"></i><b>1.11.1</b> Contingency tables</a></li>
</ul></li>
<li class="chapter" data-level="1.12" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>2</b> Visual data exploration</a><ul>
<li class="chapter" data-level="2.1" data-path="visualization.html"><a href="visualization.html#prerequisites-1"><i class="fa fa-check"></i><b>2.1</b> Prerequisites</a></li>
<li class="chapter" data-level="2.2" data-path="visualization.html"><a href="visualization.html#univariate-data"><i class="fa fa-check"></i><b>2.2</b> Univariate data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="visualization.html"><a href="visualization.html#continuous-variables"><i class="fa fa-check"></i><b>2.2.1</b> Continuous Variables</a></li>
<li class="chapter" data-level="2.2.2" data-path="visualization.html"><a href="visualization.html#categorical-variables"><i class="fa fa-check"></i><b>2.2.2</b> Categorical Variables</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="visualization.html"><a href="visualization.html#bivariate-data"><i class="fa fa-check"></i><b>2.3</b> Bivariate data</a><ul>
<li class="chapter" data-level="2.3.1" data-path="visualization.html"><a href="visualization.html#scatter-plots"><i class="fa fa-check"></i><b>2.3.1</b> Scatter plots</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="visualization.html"><a href="visualization.html#multivariate-data"><i class="fa fa-check"></i><b>2.4</b> Multivariate data</a><ul>
<li class="chapter" data-level="2.4.1" data-path="visualization.html"><a href="visualization.html#facetting"><i class="fa fa-check"></i><b>2.4.1</b> Facetting</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="visualization.html"><a href="visualization.html#data-quality"><i class="fa fa-check"></i><b>2.5</b> Data quality</a></li>
<li class="chapter" data-level="2.6" data-path="visualization.html"><a href="visualization.html#further-reading"><i class="fa fa-check"></i><b>2.6</b> Further reading</a></li>
<li class="chapter" data-level="2.7" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="inference.html"><a href="inference.html"><i class="fa fa-check"></i><b>3</b> Statistical Inference</a><ul>
<li class="chapter" data-level="3.1" data-path="inference.html"><a href="inference.html#the-frequentist-approach"><i class="fa fa-check"></i><b>3.1</b> The frequentist approach</a><ul>
<li class="chapter" data-level="3.1.1" data-path="inference.html"><a href="inference.html#the-central-limit-theorem"><i class="fa fa-check"></i><b>3.1.1</b> The central limit theorem</a></li>
<li class="chapter" data-level="3.1.2" data-path="inference.html"><a href="inference.html#hypothesis-testing"><i class="fa fa-check"></i><b>3.1.2</b> Hypothesis testing</a></li>
<li class="chapter" data-level="3.1.3" data-path="inference.html"><a href="inference.html#one-sided-versus-two-sided-tests"><i class="fa fa-check"></i><b>3.1.3</b> One-sided versus two-sided tests</a></li>
<li class="chapter" data-level="3.1.4" data-path="inference.html"><a href="inference.html#type-i-and-type-ii-errors"><i class="fa fa-check"></i><b>3.1.4</b> Type I and type II errors</a></li>
<li class="chapter" data-level="3.1.5" data-path="inference.html"><a href="inference.html#p-values"><i class="fa fa-check"></i><b>3.1.5</b> <span class="math inline">\(p\)</span>-values</a></li>
<li class="chapter" data-level="3.1.6" data-path="inference.html"><a href="inference.html#confidence-intervals"><i class="fa fa-check"></i><b>3.1.6</b> Confidence intervals</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="inference.html"><a href="inference.html#one--and-two-sample-t-tests"><i class="fa fa-check"></i><b>3.2</b> One- and two-sample t-tests</a><ul>
<li class="chapter" data-level="3.2.1" data-path="inference.html"><a href="inference.html#one-sample-t-test"><i class="fa fa-check"></i><b>3.2.1</b> One-sample t-test</a></li>
<li class="chapter" data-level="3.2.2" data-path="inference.html"><a href="inference.html#two-sample-t-test"><i class="fa fa-check"></i><b>3.2.2</b> Two-sample t-test</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="inference.html"><a href="inference.html#tests-involving-more-than-two-means-anova-models"><i class="fa fa-check"></i><b>3.3</b> Tests involving more than two means: ANOVA models</a></li>
<li class="chapter" data-level="3.4" data-path="inference.html"><a href="inference.html#testing-for-association-in-contingency-tables"><i class="fa fa-check"></i><b>3.4</b> Testing for association in contingency tables</a></li>
<li class="chapter" data-level="3.5" data-path="inference.html"><a href="inference.html#nonparametric-tests"><i class="fa fa-check"></i><b>3.5</b> Nonparametric tests</a></li>
<li class="chapter" data-level="3.6" data-path="inference.html"><a href="inference.html#the-nonparametric-bootstrap"><i class="fa fa-check"></i><b>3.6</b> The nonparametric bootstrap</a><ul>
<li class="chapter" data-level="3.6.1" data-path="inference.html"><a href="inference.html#bootstrap-confidence-intervals"><i class="fa fa-check"></i><b>3.6.1</b> Bootstrap confidence intervals</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="inference.html"><a href="inference.html#further-reading-1"><i class="fa fa-check"></i><b>3.7</b> Further reading</a></li>
<li class="chapter" data-level="3.8" data-path="inference.html"><a href="inference.html#exercises-1"><i class="fa fa-check"></i><b>3.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="unsupervised.html"><a href="unsupervised.html"><i class="fa fa-check"></i><b>4</b> Unsupervised learning</a><ul>
<li class="chapter" data-level="4.1" data-path="unsupervised.html"><a href="unsupervised.html#prerequisites-2"><i class="fa fa-check"></i><b>4.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.2" data-path="unsupervised.html"><a href="unsupervised.html#principal-components-analysis"><i class="fa fa-check"></i><b>4.2</b> Principal Components Analysis</a><ul>
<li class="chapter" data-level="4.2.1" data-path="unsupervised.html"><a href="unsupervised.html#finding-principal-components"><i class="fa fa-check"></i><b>4.2.1</b> Finding principal components</a></li>
<li class="chapter" data-level="4.2.2" data-path="unsupervised.html"><a href="unsupervised.html#performing-pca-in-r"><i class="fa fa-check"></i><b>4.2.2</b> Performing PCA in R</a></li>
<li class="chapter" data-level="4.2.3" data-path="unsupervised.html"><a href="unsupervised.html#selecting-the-number-of-principal-components"><i class="fa fa-check"></i><b>4.2.3</b> Selecting the Number of Principal Components</a></li>
<li class="chapter" data-level="4.2.4" data-path="unsupervised.html"><a href="unsupervised.html#extracting-additional-insights"><i class="fa fa-check"></i><b>4.2.4</b> Extracting additional insights</a></li>
<li class="chapter" data-level="4.2.5" data-path="unsupervised.html"><a href="unsupervised.html#pca-with-mixed-data"><i class="fa fa-check"></i><b>4.2.5</b> PCA with mixed data</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="unsupervised.html"><a href="unsupervised.html#cluster-analysis"><i class="fa fa-check"></i><b>4.3</b> Cluster Analysis</a><ul>
<li class="chapter" data-level="4.3.1" data-path="unsupervised.html"><a href="unsupervised.html#clustering-distance-measures"><i class="fa fa-check"></i><b>4.3.1</b> Clustering distance measures</a></li>
<li class="chapter" data-level="4.3.2" data-path="unsupervised.html"><a href="unsupervised.html#k-means-clustering"><i class="fa fa-check"></i><b>4.3.2</b> K-means clustering</a></li>
<li class="chapter" data-level="4.3.3" data-path="unsupervised.html"><a href="unsupervised.html#hierarchical-clustering"><i class="fa fa-check"></i><b>4.3.3</b> Hierarchical clustering</a></li>
<li class="chapter" data-level="4.3.4" data-path="unsupervised.html"><a href="unsupervised.html#clustering-with-mixed-data"><i class="fa fa-check"></i><b>4.3.4</b> Clustering with mixed data</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Predictive Analytics</b></span><ul>
<li class="chapter" data-level="4.4" data-path="unsupervised.html"><a href="unsupervised.html#regression-problems"><i class="fa fa-check"></i><b>4.4</b> Regression problems</a></li>
<li class="chapter" data-level="4.5" data-path="unsupervised.html"><a href="unsupervised.html#classification-problems"><i class="fa fa-check"></i><b>4.5</b> Classification problems</a></li>
<li class="chapter" data-level="4.6" data-path="unsupervised.html"><a href="unsupervised.html#algorithm-comparison-guide"><i class="fa fa-check"></i><b>4.6</b> Algorithm Comparison Guide</a></li>
<li class="chapter" data-level="4.7" data-path="unsupervised.html"><a href="unsupervised.html#general-modeling-process"><i class="fa fa-check"></i><b>4.7</b> General modeling process</a><ul>
<li class="chapter" data-level="4.7.1" data-path="unsupervised.html"><a href="unsupervised.html#reg_perf_prereq"><i class="fa fa-check"></i><b>4.7.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.7.2" data-path="unsupervised.html"><a href="unsupervised.html#reg_perf_split"><i class="fa fa-check"></i><b>4.7.2</b> Data splitting</a></li>
<li class="chapter" data-level="4.7.3" data-path="unsupervised.html"><a href="unsupervised.html#reg_perf_feat"><i class="fa fa-check"></i><b>4.7.3</b> Feature engineering</a></li>
<li class="chapter" data-level="4.7.4" data-path="unsupervised.html"><a href="unsupervised.html#model-form"><i class="fa fa-check"></i><b>4.7.4</b> Basic model formulation</a></li>
<li class="chapter" data-level="4.7.5" data-path="unsupervised.html"><a href="unsupervised.html#reg_perf_tune"><i class="fa fa-check"></i><b>4.7.5</b> Model tuning</a></li>
<li class="chapter" data-level="4.7.6" data-path="unsupervised.html"><a href="unsupervised.html#cv"><i class="fa fa-check"></i><b>4.7.6</b> Cross Validation for Generalization</a></li>
<li class="chapter" data-level="4.7.7" data-path="unsupervised.html"><a href="unsupervised.html#reg_perf_eval"><i class="fa fa-check"></i><b>4.7.7</b> Model evaluation</a></li>
<li class="chapter" data-level="4.7.8" data-path="unsupervised.html"><a href="unsupervised.html#interpreting-predictive-models"><i class="fa fa-check"></i><b>4.7.8</b> Interpreting predictive models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear regression</a><ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#prerequisites-3"><i class="fa fa-check"></i><b>5.1</b> Prerequisites</a></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#the-idea"><i class="fa fa-check"></i><b>5.2</b> The Idea</a><ul>
<li class="chapter" data-level="5.2.1" data-path="linear-regression.html"><a href="linear-regression.html#simple-linear-regression"><i class="fa fa-check"></i><b>5.2.1</b> Simple linear regression</a></li>
<li class="chapter" data-level="5.2.2" data-path="linear-regression.html"><a href="linear-regression.html#multi-lm"><i class="fa fa-check"></i><b>5.2.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="5.2.3" data-path="linear-regression.html"><a href="linear-regression.html#assumptions"><i class="fa fa-check"></i><b>5.2.3</b> Assumptions</a></li>
<li class="chapter" data-level="5.2.4" data-path="linear-regression.html"><a href="linear-regression.html#advantages-disadvantages"><i class="fa fa-check"></i><b>5.2.4</b> Advantages &amp; Disadvantages</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="linear-regression.html"><a href="linear-regression.html#basic-implementation"><i class="fa fa-check"></i><b>5.3</b> Basic implementation</a></li>
<li class="chapter" data-level="5.4" data-path="linear-regression.html"><a href="linear-regression.html#predictive-accuracy"><i class="fa fa-check"></i><b>5.4</b> Predictive accuracy</a></li>
<li class="chapter" data-level="5.5" data-path="linear-regression.html"><a href="linear-regression.html#adding-more-predictors"><i class="fa fa-check"></i><b>5.5</b> Adding more predictors</a></li>
<li class="chapter" data-level="5.6" data-path="linear-regression.html"><a href="linear-regression.html#model-concerns"><i class="fa fa-check"></i><b>5.6</b> Model concerns</a></li>
<li class="chapter" data-level="5.7" data-path="linear-regression.html"><a href="linear-regression.html#dimension-reduction-with-pca"><i class="fa fa-check"></i><b>5.7</b> Dimension reduction with PCA</a></li>
<li class="chapter" data-level="5.8" data-path="linear-regression.html"><a href="linear-regression.html#dimension-reduction-with-pls"><i class="fa fa-check"></i><b>5.8</b> Dimension reduction with PLS</a></li>
<li class="chapter" data-level="5.9" data-path="linear-regression.html"><a href="linear-regression.html#variable-importance"><i class="fa fa-check"></i><b>5.9</b> Variable importance</a></li>
<li class="chapter" data-level="5.10" data-path="linear-regression.html"><a href="linear-regression.html#learning-more"><i class="fa fa-check"></i><b>5.10</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="6" data-path="appendix-data.html"><a href="appendix-data.html"><i class="fa fa-check"></i><b>6</b> (APPENDIX) Appendix {-}</a><ul>
<li class="chapter" data-level="" data-path="appendix-data.html"><a href="appendix-data.html#ames-iowa-housing-data-1"><i class="fa fa-check"></i>Ames Iowa housing data</a></li>
<li class="chapter" data-level="" data-path="appendix-data.html"><a href="appendix-data.html#employee-attrition-data-1"><i class="fa fa-check"></i>Employee attrition data</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Business Analytics with R: Descriptive, Predictive, and Prescriptive Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visualization" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Visual data exploration</h1>
<blockquote>
<p>“Pie charts do not provide efficient detection of geometric objects that convey information about differences of values.”</p>
<p>— William S. Cleveland</p>
</blockquote>
<p>As mentioned at the beginning of Chapter <a href="intro.html#descriptive">1.1</a>, the first step in any data analysis problem is to simply “look” at the data. In the previous chapter, we did this using numerical summaries of the data (i.e., descriptive statistics). In this chapter, we discuss graphical summaries of the data—these two tasks go hand in hand.</p>
<p>One of the biggest strengths of R is its ability to produce high-quality static graphics. While base R can produce high quality graphics with ease, a number of add-on packages provide enhanced graphics capabilities. Two of the most popular packages are <code>lattice</code> <span class="citation">(Sarkar <a href="#ref-pkg-lattice">2008</a>)</span> and <code>ggplot2</code> <span class="citation">(Wickham <a href="#ref-pkg-ggplot2">2009</a>)</span>—both of which are built on top of R’s <code>grid</code> graphics system. Dynamic and interactive graphics are also readily available through add-on packages like <code>plotly</code> <span class="citation">(Sievert et al. <a href="#ref-pkg-plotly">2017</a>)</span>. This chapter makes extensive use of <code>ggplot2</code>—a popular package for creating graphics based on <em>The Grammar of Graphics</em>; see <code>help(&quot;ggplot2-package&quot;, package = &quot;ggplot2&quot;)</code> for details and useful links.</p>

<div class="note">
Although this chapter uses <code>ggplot2</code>, the R code for recreating most of the graphs (where possible) using both <code>lattice</code> and base R graphics is available on the book’s <a href="https://github.com/koalaverse/abar">GitHub repo</a>. One advantage of <code>lattice</code> over <code>ggplot2</code> is its ability to create 3-dimensional graphics and <em>shingles</em> (see <code>?lattice::cloud</code> and <code>?lattice::shingle</code>, respectively, for additional information).
</div>

<!-- Data visualization is a critical tool in the data analysis process. Data visualization tasks can range from generating fundamental distribution plots to understanding the interplay of complex influential variables in machine learning algorithms. In this chapter we focus on the use of visualization for initial *data exploration*.  -->
<p>Visual data exploration (VDE) is critical to understanding your data. When combined with descriptive statistics (Chapter <a href="intro.html#descriptive">1.1</a>), VDE provides an effective way to identify relationships and abnormalities (e.g., outliers), and communicate summaries of the data. In fact, sometimes no elaborate analysis is necessary at all as most of the important conclusions <!--required for a decision--> are evident by simply examining the data visually. <!--Other times, data exploration will be used to help guide in the initial stages of predictive modelling (i.e., data cleaning, feature selection, and data splitting).--></p>
<p>Regardless of the intent, VDE is about investigating the characteristics of your data set. To do this, we typically create numerous plots in an <!--interactive--> iterative fashion. This chapter will show you how to create such plots, and use them to answer fundamental questions about the data.</p>
<div id="prerequisites-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Prerequisites</h2>
<p>In this chapter we’ll illustrate the key ideas of VDE using the Ames housing data. We’ll also use several <code>tidyverse</code> packages, including: <code>dplyr</code>, for data manipulation; <code>ggplot2</code>, for creating graphs; as well as some useful graphical functions from other packages (most of which rely on <code>ggplot2</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load required packages</span>
<span class="kw">library</span>(dplyr)         <span class="co"># for data manipulation</span>
<span class="kw">library</span>(ggplot2)       <span class="co"># for creating graphs</span>
<span class="kw">library</span>(gridExtra)     <span class="co"># for displaying multiple (ggplot2) graphs in one figure</span>
<span class="kw">library</span>(scales)        <span class="co"># for better breaks and labels in ggplot2 axes</span>

<span class="co"># Additional packages that need to be installed: AmesHousing, forcats, GGally, </span>
<span class="co"># ggridges, RColorBrewer, reshape2, purrr, and viridis</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames &lt;-<span class="st"> </span>AmesHousing<span class="op">::</span><span class="kw">make_ames</span>()  <span class="co"># load the Ames housing data</span></code></pre></div>
<p><code>ggplot2</code> constructs plots in layers. For example, add points, then add trend lines, etc. A general formula for a <code>ggplot2</code> graph is given below. Notice, we always start by using <code>ggplot()</code> to construct an empty canvas.</p>
<pre><code>ggplot() +
  geom_&lt;geom-1-name&gt;(data = &lt;data-1-name&gt;, aes(&lt;aesthetic mappings&gt;), &lt;options&gt;) +
  geom_&lt;geom-2-name&gt;(data = &lt;data-2-name&gt;, aes(&lt;aesthetic mappings&gt;), &lt;options&gt;) +
  ...</code></pre>
<p>If all the layers use the same data set (as in most of this chapter), you can provide the data and aesthetics to the <code>ggplot()</code> function instead, as in</p>
<pre><code>ggplot(&lt;data-name&gt;, aes(&lt;aesthetic mappings&gt;)) +
  geom_&lt;geom-1-name&gt;(&lt;options&gt;) +
  geom_&lt;geom-2-name&gt;(&lt;options&gt;) +
  ...</code></pre>
</div>
<div id="univariate-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Univariate data</h2>
<p>An important first step in VDE is to to understand how individual variables are distributed. Visualizing the distribution of a variable allows us to easily understand and describe many of its features. This is complementary to describing the distribution of a variable using various descriptive statistics, as described in Chapter <a href="intro.html#descriptive">1.1</a>.</p>
<div id="continuous-variables" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Continuous Variables</h3>
<p>A variable is <em>continuous</em> if it can take any of an infinite set of ordered values (e.g., income and price). There are several different features we are generally interested in with continuous variables (i.e. measures of location, measures of spread, asymmetry, outliers). Different plots can effectively communicate these different features of continuous variables.</p>

<div class="note">
Techincally, no variable in a data set is truly continuous, as measurements are never recorded with infinite precision. In a <em>census</em>, for example, age is typically recorded in years, but typically treated as continuous during analysis. What’s important for a variable to be treated as continuous is our willingness to treat the differences between values as <em>quantitative</em>. For the purposes of this book, continuous variables are also referred to as numeric or quantitative variables.
</div>

<div id="histograms" class="section level4">
<h4><span class="header-section-number">2.2.1.1</span> Histograms</h4>
<p>One of the most effective ways to visualize the distribution (in particular, the density) of a continuous variable is to use a <em>histogram</em>; our first example of a histogram was seen in Figure <a href="#fig:sale-price-hist"><strong>??</strong></a> for the variable <code>Sale_Price</code>. Although rather crude estimates, histograms were indispensable tools in the days before computers were mainstream.</p>
<p>Histograms are often overlooked, yet they offer an efficient means for communicating important features of continuous variables (e.g., skewness). Histograms are just special bar charts! First, the variable is broken into equal sized intervals, called bins, and the number of observations that fall into each bin is counted (these are called frequencies). A histogram is nothing more than a simple bar chart of these frequencies (where each bar represents a different bin). Histograms quickly signal what the most common observations are for the variable being assessed (the higher the bar the more frequent those values are observed in the data); they also signal the shape (spread and symmetry) of the data by illustrating if the observed values cluster towards one end or the other of the distribution.</p>
<p>To get a quick sense of how <code>Sale_Price</code> is distributed, we can generate a histogram estimate of its density using <code>ggplot2</code>’s <code>geom_histogram()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-hist-sale-price-01"></span>
<img src="abar_files/figure-html/04-hist-sale-price-01-1.png" alt="Default histogram of `Sale_Price`." width="70%" />
<p class="caption">
Figure 2.1: Default histogram of <code>Sale_Price</code>.
</p>
</div>
<p>Figure <a href="visualization.html#fig:04-hist-sale-price-01">2.1</a> conveys several important features about the distribution of <code>Sale_Price</code>:</p>
<ul>
<li><strong>measures of location</strong> (<a href="intro.html#measures-of-location">1.6</a>): the most common values of <code>Sale_Price</code> are around $160K (the median);</li>
<li><strong>measures of spread</strong> (<a href="intro.html#measures-of-spread">1.7</a>): <code>Sale_Price</code> ranges from near zero to over $700K;</li>
<li><strong>skewness</strong>: <code>Sale_Price</code> is skewed right (a common feature of financial data);</li>
<li><strong>outliers</strong> (<a href="intro.html#outliers">1.10</a>): there appears to be some abnormally large values of <code>Sale_Price</code>. <!-- - **gaps**: we see a gap in `Sale_Price` roughly between \$650K and \$700K+.  --> Some of the analytic techniques we will learn about in later chapters are sensitive to outliers and assume that the data are (at least approximately) symmetric. Histograms, as well may of the graphical displays in this chapter, are invaluable tools for identifying there and other potential problems with our data.</li>
</ul>
<p><strong>FIXME:</strong> The footnote in this section does not make sense.</p>
<p>By default, <code>geom_histogram()</code> will divide the values of a continuous variable into 30 equally sized bins. Since <code>Sale_Price</code> ranges from $12,789–$755,000, 30 equally sized bins implies a bin width of <span class="math inline">\(\frac{\left\lfloor{\$755,000 - \$12,789}\right\rfloor}{30} = \$24,740\)</span>. So in Figure <a href="visualization.html#fig:04-hist-sale-price-01">2.1</a>, the first bar represents the frequency of <code>Sale_Price</code> in the range of (roughly) <span class="math inline">\(\left[\$12,500, \ \$37,500\right]\)</span><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>, the second bar represents the frequency of <code>Sale_Price</code> in the range of (roughly) <span class="math inline">\(\left[\$37,500, \ \$62,300\right]\)</span>, and so on.</p>

<div class="tip">
The number of bins (or equivalently, the bin width) in a histogram is a <em>tuning parameter</em> that should be adjusted specifically for each application. Adjusting the bin width is somewhat subjective and needs to be done carefully (usually by eye). If the bin width is “too small”, the histogram will <em>overfit</em> the data and display too much noise. If the bin width is “too large”, the histogram will <em>underfit</em> the data and important features (like outliers) will be missed.
</div>

<p>In <code>geom_histogram()</code>, we can use the <code>binwidth</code> and <code>bins</code> arguments to control the bin width and number of bins, respectively (but only one argument needs to be specified). By adjusting one of these parameters, we can change the crudeness of the histogram estimate of the variable’s density. For instance, in the default histogram, the bin with the largest frequency ranged from $136,000–$161,000; however, as demonstrated below, we can often do better by manually adjusting the bin width<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Histograms with various bin widths</span>

<span class="co"># Too crude (i.e., under fitting)</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">100000</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bin width = $100,000&quot;</span>)  

<span class="co"># Less crude</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">50000</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bin width = $50,000&quot;</span>)

<span class="co"># Just right?</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">5000</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bin width = $5,000&quot;</span>)

<span class="co"># Too flexible (i.e., over fitting)</span>
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1000</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Bin width = $1,000&quot;</span>)  

<span class="co"># Display plots in a grid</span>
<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:hist2"></span>
<img src="abar_files/figure-html/hist2-1.png" alt="Adjusting histogram bin width." width="70%" />
<p class="caption">
Figure 2.2: Adjusting histogram bin width.
</p>
</div>
<p>The most common value of <code>Sale_Price</code> (i.e., the statistical mode) is $135,000 (this is roughly where the peak of each histogram occurs). R does not have a built-in function for finding the most common value in a set of observations, but we can easily find it using a combination of <code>which.max()</code> and <code>table()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">which.max</span>(<span class="kw">table</span>(ames<span class="op">$</span>Sale_Price))
## 135000 
##    270</code></pre></div>
<p>The mode of a continuous variable is another measure of location (measures-of-location). The mode of a sample is the value that occurs most frequently—this also makes the mode a useful descriptive statistic for categorical data as well. If the sample values are not unique, there will exist multiple modes (i.e., the data are said to be <em>multimodal</em>). For continuous data, unlike the sample mean and median, computing the mode is not straightforward (e.g., what is the mode of <span class="math inline">\(x = \left\{0.001, 3.514, 6.799, \dots\right\}\)</span>). Fortunately, the modes (or peaks in the density) of a sample are easily seen from density estimates like histograms. Recall that the mean and median of <code>Sale_Price</code> were $180,796.10 and $160,000, respectively. For <em>unimodal</em> distributions (i.e., distributions with only a single peak), the median will often lie between the mean and the mode. For perfectly symmetric distributions, the mean, median, and mode are all the same (though, this rarely, if ever, happens in practice). This is especially true for right skew data like <code>Sale_Price</code>.</p>
<p>As discussed in Chapter <a href="intro.html#descriptive">1.1</a>, a log transformation is often useful for making right skewed data look more symmetric; taking the square root is also effective for this purpose. While we can simply apply such transformations to the data ourselves, <code>ggplot2</code> offers several useful functions for plotting data on various scales; in our case, we can use the <code>scale_x_log()</code> and <code>scale_x_sqrt()</code> functions to apply a <span class="math inline">\(log_{10}\)</span> and square root transformation, respectively<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>. This is demonstrated in the code below which produces Figure <a href="#fig:04-hist-transformed"><strong>??</strong></a>. In this case, the <span class="math inline">\(log_{10}\)</span> transformation was more effective at making the data appear more symmetric.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Log 10 scale</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">50</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels =</span> dollar, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">50000</span>, <span class="dv">125000</span>, <span class="dv">300000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Sale_Price (log10 scale)&quot;</span>)

<span class="co"># Square root scale</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">50</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">labels =</span> dollar, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">50000</span>, <span class="dv">125000</span>, <span class="dv">300000</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Sale_Price (square root scale)&quot;</span>)

<span class="co"># Display both plots side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-hist-sales-transformed"></span>
<img src="abar_files/figure-html/04-hist-sales-transformed-1.png" alt="Histogram of `Sale_Price` using different transformation scales. *Left*: $log_{10}$ scale. *Right*: Square root scale." width="70%" />
<p class="caption">
Figure 2.3: Histogram of <code>Sale_Price</code> using different transformation scales. <em>Left</em>: <span class="math inline">\(log_{10}\)</span> scale. <em>Right</em>: Square root scale.
</p>
</div>
<p>Oftentimes, it will be useful to “smooth the histogram” by overlaying a <em>kernel density estimate</em>: an alternative to histograms for data assumed to come from a smooth, continuous distribution. To plot a kernel density estimate in <code>ggplot2</code>, we use the <code>geom_density()</code> function. For example, the following code constructs a simple kernel density estimate for <code>Sale_Price</code>. Additionally, we also add a <em>rug</em> representation (i.e., one-dimensional marginal distribution) of <code>Sale_Price</code> to the <span class="math inline">\(x\)</span>-axis using the <code>geom_rug()</code> function. Rug displays give additional insight into the spread of the distribution of the continuous variable of interest; by default, rug displays plot one tick mark for each data point, but with lots of data, it may be more useful to plot certain percentiles (e.g., the deciles of the distribution). Rug displays are uses in various plots throughout this book. <!--Another useful plot for univariate assessment includes the *smoothed* histogram in which a non-parametric approach is used to estimate the density function. Displaying in density form just means the y-axis is now in a probability scale where the proportion of the given value (or bin of values) to the overall population is displayed. In essence, the y-axis tells you the estimated probability of the x-axis value occurring. This results in a *smoothed* curve known as the density plot that allows us visualize the distribution. Since the focus of a density plot is to view the overall distribution rather than individual bin observations we lose insight into how many observations occur at certain x values. Consequently, it can be helpful to use `geom_rug` with `geom_density` to highlight where clusters, outliers, and gaps of observations are occuring.--></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Kernel density estimate</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>()

<span class="co"># Add a rug representation to the x-axis</span>
p2 &lt;-<span class="st"> </span>p1 <span class="op">+</span><span class="st"> </span><span class="kw">geom_rug</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>)

<span class="co"># Display both graphs side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:density"></span>
<img src="abar_files/figure-html/density-1.png" alt="Density plot of sales price." width="70%" />
<p class="caption">
Figure 2.4: Density plot of sales price.
</p>
</div>

<div class="tip">
Rug representations can be added to any axis in a plot (as long as that axis represents a continuous variable). In <code>ggplot2</code>, we can specify which sides of the plot we want to display a 1-D marginal distribution using the <code>sides</code> argument. For example, specifying <code>sides = &quot;bl&quot;</code> (the default) will display a rug representation of the data on the bottom and left sides of the plot.
</div>

<p>In practice, we suggest using a kernel density estimate in conjunction with a histogram—as they both compliment each other. To overlay a kernel density estimate on top of a histogram, we need to plot the histogram so that the <span class="math inline">\(y\)</span>-axis is on the density scale, rather than the frequency scale (which is typically the default for a histogram). In <code>ggplot2</code>, this can be done by specifying <code>aes(y = ..density..)</code> in the call to <code>geom_histogram()</code>). We can then overlay a kernel density estimate by adding the <code>geom_density()</code> layer. This is displayed in Figure <a href="visualization.html#fig:04-histogram-density">2.5</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..), <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey65&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-histogram-density"></span>
<img src="abar_files/figure-html/04-histogram-density-1.png" alt="Histogram of `Sale_Price` with a kernel density estimate (red curve)." width="70%" />
<p class="caption">
Figure 2.5: Histogram of <code>Sale_Price</code> with a kernel density estimate (red curve).
</p>
</div>
</div>
<div id="quantile-quantile-plots" class="section level4">
<h4><span class="header-section-number">2.2.1.2</span> Quantile-quantile plots</h4>
<p>Quantile-quantile (Q-Q) plots offer a graphical way for assessing how similar data from two (possibly different) continuous distributions are. The most common use of Q-Q plots is in assessing normality; that is, whether or not it is reasonable to assume a variable is (at least approximately) normally distributed; Q-Q plots in this setting are referred to as normal Q-Q plots. Normal Q-Q plots graph the observed quantiles of the observed data against the similar quantiles from a normal distribution—such plots are often used in assessing the normality assumption in ordinary linear regression (Chapter (regression)).</p>

<div class="note">
Although commonly used to check normality, Q-Q plots can be constructed to graphically check if it is reasonable to assume a continuous variable comes from any parametric distribution!
</div>

<p>A normal Q-Q plot for <code>Sale_Price</code> is given in the left side of Figure <a href="visualization.html#fig:04-normal-qq">2.6</a>. This graph plots the sample quantiles of <code>Sale_Price</code> against the theoretical quantiles of a normal distribution (the default for <code>stat_qq()</code>). If <code>Sale-Price</code> is normally distributed, the points on the plot should lie (roughly) on a 45<span class="math inline">\(^\circ\)</span> line (imagine trying to cover the points with a “fat pencil”). If the observed data deviate from normality, then the plot will display curvature. The nature of this curvature would be informative into how <code>Sale_Price</code> deviates from normality. To produce a Q-Q plot in <code>ggplot2</code>, we can use the <code>stat_qq()</code> function. The following code chunk produces Figure <a href="visualization.html#fig:04-normal-qq">2.6</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Normal Q-Q plot of Sale_Price</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">sample =</span> Sale_Price)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_qq</span>()

<span class="co"># Normal Q-Q plot of log(Sale_Price)</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">sample =</span> <span class="kw">log</span>(Sale_Price))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_qq</span>()

<span class="co"># Display both graphs side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-normal-qq"></span>
<img src="abar_files/figure-html/04-normal-qq-1.png" alt="Normal Q-Q plots for `Sale_Price`. *Left*: Original scale. *Right*: Log-transformed scale." width="70%" />
<p class="caption">
Figure 2.6: Normal Q-Q plots for <code>Sale_Price</code>. <em>Left</em>: Original scale. <em>Right</em>: Log-transformed scale.
</p>
</div>
<p>Notice how the normal Q-Q plot for <code>Sale_Price</code> starts to bend up. This indicates that the distribution of <code>Sale_Price</code> has a heavier right tail than expected from a normal distribution (i.e., <code>Sale_Price</code> is more positively skewed than what would be expected from normally distributed data). The normal Q-Q plot for <code>log(Sale_Price)</code> is a bit more well behaved (aside from the two potential outliers and slight downward curvature in the bottom left of the graph).</p>
<!--We also mentioned how we obtained a new insight regarding a new potential outlier that we did not see earlier. So far our histogram identified potential outliers at the lower end and upper end of the sale price spectrum. Unfortunately histograms are not very good at delineating outliers. Rather, we can use a boxplot which does a better job identifying specific outliers.-->
<p>Histograms (and kernel density estimates), and Q-Q plots are great at visually summarizing the distribution of a continuous variable; especially a variable with many unique values. Unfortunately, histograms are less suitable for continuous data with few unique values, and are not great at displaying outliers (the same goes for Q-Q plots). Fortunately, a simple display of a few descriptive statistics offers a perfect compliment to histograms; this display is referred to as a <em>box plot</em>.</p>
</div>
<div id="boxplots" class="section level4">
<h4><span class="header-section-number">2.2.1.3</span> Box plots</h4>
<p>Box plots <span class="citation">(Frigge, Hoaglin, and Iglewicz <a href="#ref-frigge-some-1989">1989</a>)</span>—in particular, Tukey’s <em>box-and-whisker plots</em> <span class="citation">(Tukey <a href="#ref-tukey-exploratory-1977">1977</a>)</span>—are an effective way to compare a continuous variable between groups. For a single variable, a box of arbitrary width is drawn around the median from the lower quartile <span class="math inline">\(Q_1\)</span> to the upper quartile <span class="math inline">\(Q_3\)</span>; this box, which has length <span class="math inline">\(Q_3 - Q_1 = IQR\)</span>, contains the middle 50% of the data. The “whiskers” are formed by extending lines from the edges of the box out to <span class="math inline">\(Q_1 - 1.5 \times IQR\)</span> and <span class="math inline">\(Q_3 + 1.5 \times IQR\)</span>. Any observations lying beyond the whiskers are flagged as potential outliers and plotted as individual points. An example of a typical box plot for some skew right data is given in Figure <a href="visualization.html#fig:04-box-plot-diagram">2.7</a>. Can you easily tell from the box plot that these data are skew right? 🤔</p>
<div class="figure" style="text-align: center"><span id="fig:04-box-plot-diagram"></span>
<img src="abar_files/figure-html/04-box-plot-diagram-1.png" alt="A typical box plot." width="70%" />
<p class="caption">
Figure 2.7: A typical box plot.
</p>
</div>
<p>A box plot can be constructed in <code>ggplot2</code> using the <code>geom_boxplot()</code> layer. In the code chunk below, we use <code>geom_boxplot()</code> to construct box plots for both <code>Sale_Price</code> and <code>log10(Sale_Price)</code> (by specifying a <span class="math inline">\(\log\)</span> scale for the <span class="math inline">\(y\)</span>-axis). The results are displayed in Figure <a href="visualization.html#fig:04-box-plot-sale-price">2.8</a>. <strong>Note:</strong> we used <span class="math inline">\(log_{10}\)</span> as the scale because <code>ggplot2</code> does not have a natural log scale function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;var&quot;</span>, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar, <span class="dt">breaks =</span> <span class="kw">quantile</span>(ames<span class="op">$</span>Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Box plot for Sale_Price&quot;</span>)
p2 &lt;-<span class="st"> </span>p1 <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">labels =</span> dollar, <span class="dt">breaks =</span> <span class="kw">quantile</span>(ames<span class="op">$</span>Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Box plot for log10(Sale_Price)&quot;</span>)
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-box-plot-sale-price"></span>
<img src="abar_files/figure-html/04-box-plot-sale-price-1.png" alt="Box plots for `Sale_Price`. *Left:* Original scale. *Right:* $log_{10}$ scale." width="80%" />
<p class="caption">
Figure 2.8: Box plots for <code>Sale_Price</code>. <em>Left:</em> Original scale. <em>Right:</em> <span class="math inline">\(log_{10}\)</span> scale.
</p>
</div>
<p>A modern alternative to Tukey’s box plot, called a <em>violin</em> 🎻 <em>plot</em>, combines box plots with kernel density estimates; in <code>ggplot2</code> nomenclature, <code>geom_violin()</code> <span class="math inline">\(\approx\)</span> <code>geom_boxplot()</code> + <code>geom_density()</code>.</p>
<p>There are two efficient graphs to get an indication of potential outliers in our data. The classic box plot on the left will identify points beyond the whiskers which are beyond <span class="math inline">\(\$1.5 \times IQR\)</span> from the first and third quantile. This illustrates there are several additional observations that we may need to assess as outliers that were not evident in our histogram. However, when looking at a box plot we lose insight into the shape of the distribution. A violin plot on the right provides us a similar chart as the box plot but we lose insight into the quantiles of our data and outliers are not plotted (hence the reason we plot <code>geom_point()</code> prior to <code>geom_violin()</code>). Violin plots will come in handy later when we start to visualize multiple continuous distributions along side each other.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Box plot (log10 scale)</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="st">&quot;var&quot;</span>, Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(
    <span class="dt">labels =</span> dollar, 
    <span class="dt">breaks =</span> <span class="kw">quantile</span>(ames<span class="op">$</span>Sale_Price)
  )

<span class="co"># Violin plot (log10 scale)</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="st">&quot;var&quot;</span>, Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(
    <span class="dt">labels =</span> dollar, 
    <span class="dt">breaks =</span> <span class="kw">quantile</span>(ames<span class="op">$</span>Sale_Price)
  )

<span class="co"># DIsplay both plots side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-boxplot-violin"></span>
<img src="abar_files/figure-html/04-boxplot-violin-1.png" alt="Box plot (left) and violin plot (right)." width="70%" />
<p class="caption">
Figure 2.9: Box plot (left) and violin plot (right).
</p>
</div>
<p>The box plot starts to answer the question of what potential outliers exist in our data. Outliers in data can distort predictions and affect their accuracy. Consequently, it’s important to understand if outliers are present and, if so, which observations are considered outliers. <!--Boxplots provide a visual assessment of potential outliers while the `outliers` package provides a number of useful functions to systematically extract these outliers. The most useful function is the `scores` function, which computes normal, t, chi-squared, IQR and MAD scores of the given data which you can use to find observation(s) that lie beyond a given value.

Here, we use the `outliers::score` function to extract those observations beyond the whiskers in our boxplot and then use a stem-and-leaf plot to assess them. A stem-and-leaf plot is a special table where each data value is split into a "stem" (the first digit or digits) and a "leaf" (usually the second digit). Since the decimal point is located 5 digits to the right of the "|"" the last stem of "7" and and first leaf of "5" means an outlier exists at around \$750,000. The last stem of "7" and and second leaf of "6" means an outlier exists at around \$760,000. This is a concise way to see approximately where our outliers are. In fact, we can now see that we have 28 lower end outliers ranging from \$10,000-\$60,000 and 32 upper end outliers ranging from \$450,000-\$760,000.


```r
outliers <- outliers::scores(log(ames$Sale_Price), type = "iqr", lim = 1.5)
stem(ames$Sale_Price[outliers])
## 
##   The decimal point is 5 digit(s) to the right of the |
## 
##   0 | 1134444445555555666666666666
##   1 | 
##   2 | 
##   3 | 
##   4 | 56666777788899
##   5 | 000445566889
##   6 | 1123
##   7 | 56
```
--></p>
<!-- You may also be interested to see if there are any systematic groupings with how the data is structured. For example, using base R's `plot` function with just the `Sale_Price` will plot the sale price versus the index (row) number of each observation. In the plot below we see a pattern which indicates that groupings of homes with high versus lower sale prices are concentrated together throughout the data set.  -->
<!-- ```{r indexplot, fig.align='center', fig.width=7, fig.height=3, fig.cap="Index plot."} -->
<!-- plot(ames$Sale_Price, col = rgb(0,0,0, alpha = 0.3)) -->
<!-- ``` -->
<!-- There are also a couple plots that can come in handy when dealing with smaller data sets. For example, the dot plot below provides more clarity than the histogram for viewing the distribution of `mpg` in the built-in `mtcars` data set with only 32 observations. An alternative to this would be using a strip chart (see `stripchart`).  -->
<!-- ```{r dotplot, fig.width=9, fig.height=4, fig.cap="Dotplot versus histogram for small data sets."} -->
<!-- p1 <- ggplot(mtcars, aes(x = mpg)) + -->
<!--   geom_dotplot(method = "histodot", binwidth = 1) + -->
<!--   ggtitle("dotplot") -->
<!-- p2 <- ggplot(mtcars, aes(x = mpg)) + -->
<!--   geom_histogram(binwidth = 1) + -->
<!--   ggtitle("histogram") -->
<!-- grid.arrange(p1, p2, nrow = 1) -->
<!-- ``` -->
<p>As demonstrated, several plots exist for examining univariate continuous variables. Several examples were provided here but still more exist (i.e. frequency polygon, bean plot, shifted histograms). There is some general advice to follow such as histograms being poor for small data sets, dot plots being poor for large data sets, histograms being poor for identifying outlier cut-offs, box plots being good for outliers but obscuring multimodality. Consequently, it is important to draw a variety of plots. Moreover, it is important to adjust parameters within plots (i.e. bin width, axis transformation for skewed data) to get a comprehensive picture of the variable of concern.</p>
<p>In this section, we have introduced several fundamental, but useful, graphics for continuous variables. This is by no mean an exhaustive list and we will see many different types of graphics throughout the book. In practice, it is often helpful (encouraged, in fact) to look at many types of graphics for a particular variable. For continuous variables, it is often useful to look at histograms, box plots, Q-Q plots, and a number of other graphics (depending on the situation). A useful graphical summary for a continuous variable is called the <em>four plot</em> (<strong>REFERENCE</strong>). A four plot displays a wealth of important information about continuous variables, especially as it relates to typical analytic tasks (e.g., density, correlation, outliers, etc.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..), <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&quot;purple2&quot;</span>)
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">sample =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_qq</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)
ames<span class="op">$</span>Index &lt;-<span class="st"> </span><span class="kw">seq_len</span>(<span class="kw">nrow</span>(ames))  <span class="co"># add row number as a new column</span>
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Index, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)
<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-four-plot"></span>
<img src="abar_files/figure-html/04-four-plot-1.png" alt="ABC." width="100%" />
<p class="caption">
Figure 2.10: ABC.
</p>
</div>
</div>
</div>
<div id="categorical-variables" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Categorical Variables</h3>
<p>Categorical variables, in contrast to numeric, can only take on a finite number of distinct values. For example, <span class="math inline">\(\left\{Male, Female\right\}\)</span> or <span class="math inline">\(\left\{low, medium, high\right\}\)</span>. In statistics, categorical variables are often referred to as <em>factors</em>. With categorical variables, as discussed in Chapter <a href="intro.html#descriptive">1.1</a>, we are often interested in tabulating frequencies and estimating proportions. Graphically, these are easiest to display via bar charts and dot plots. In general, dot plots are referred to bar charts as they can display mostly the same information, but in a more concise plot.</p>
<div id="bar-charts" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> Bar charts</h4>
<p>In a typical bar chart, each bar represents a different category (e.g., <span class="math inline">\(Male\)</span> or <span class="math inline">\(Female\)</span>) and the height of each bar represents the frequency (or proportion) of observations within each category. By default, the <span class="math inline">\(x\)</span>-axis typically represents categories; however, as we will see, it is often useful to “flip” bar charts horizontally for readability, especially when the number of categories is large. We have already seen bar charts in the form of a histogram—the difference there being that the bars (i.e., categories) were created by binning a numeric variable into (roughly) equal sized buckets.</p>
<!-- Bar charts are one of the most commonly used data visualizations for categorical variables. Bar charts display the levels of a categorical variable of interest (typically) along the x-axis and the length of the bar illustrates the value along the y-axis. Consequently, the length of the bar is the primary visual cue in a bar chart and in a univariate visualization this length represents counts of cases in that particular level. -->
<p>If we look at the general zoning classification (<code>MS_Zoning</code>) for each property sold in our <code>ames</code> data set, we see that the majority of all properties fall within one category. We can use <code>ggplot2</code>’s <code>geom_bar()</code> function to construct simple bar charts. By default, <code>geom_bar()</code> simply counts the observations within each category and displays them in a vertical bar chart. A bar chart for <code>MS_Zoning</code> is displayed in Figure <a href="visualization.html#fig:04-bar-chart-01">2.11</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(MS_Zoning)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">55</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-bar-chart-01"></span>
<img src="abar_files/figure-html/04-bar-chart-01-1.png" alt="Basic bar chart." width="70%" />
<p class="caption">
Figure 2.11: Basic bar chart.
</p>
</div>

<div class="tip">
The visual order of categories is important for bar charts and dot plots. By default, <code>ggplot2</code> (and most other graphical packages) plot the categories in alphabetical order—which is not visually appealing. In <code>ggplot2</code> we can use the <code>reorder()</code> function to easily plot the categories of a variable in a particular order, as demonstrated in Figure (04-bar-chart-02).
</div>

<p><code>MS_Zoning</code> is an example of a <em>nominal</em> categorical variable; a categorical variable for which there is no logical ordering of the categories (as opposed to <code>low</code>, <code>medium</code>, and <code>high</code>, for example). To get better clarity of nominal variables we can make some refinements. We can also draw bar charts manually using <code>geom_col()</code>. To do this, we first need to compute the length of each bar. For frequencies, we can use <code>dplyr::count()</code> to tally the number of observations within each category. We can then use <code>dplyr::mutate()</code> to convert frequencies to proportions. With this approach, we can use <code>reorder()</code> to easily reorder the bar categories from most frequent to least (or vice versa). For readability, we can also apply <code>coord_flip()</code> to rotate the bar chart (or any <code>ggplot2</code> figure) on its side. These refinements are demonstrated in the code chunk below.</p>
<!-- For illustration, we'll also use `geom_point()` to construct equivalent dot plots. The dot plots look a little cleaner and you don't have to worry about the bars getting squished together when plotting a large number of categories. -->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Bar chart of frequencies</span>
p1 &lt;-<span class="st"> </span>ames <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(MS_Zoning) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">reorder</span>(MS_Zoning, n), n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st">  </span><span class="co"># now x becomes y</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;MS_Zoning&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>)  <span class="co"># better labels</span>

<span class="co"># Bar chart of proportions</span>
p2 &lt;-<span class="st"> </span>ames <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(MS_Zoning) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># convert to proportions</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">reorder</span>(MS_Zoning, pct), pct)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st">  </span><span class="co"># now x becomes y</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;MS_Zoning&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Relative frequency&quot;</span>) <span class="op">+</span><span class="st">  </span><span class="co"># better labels</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent)

<span class="co"># Dispay both plots side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-bar-chart-02"></span>
<img src="abar_files/figure-html/04-bar-chart-02-1.png" alt="Bar chart and dot plots of `MS_Zoning`. *Left*: Bar chart of frequencies. *Right*: Bar chart of relative frequencies (%)." width="70%" />
<p class="caption">
Figure 2.12: Bar chart and dot plots of <code>MS_Zoning</code>. <em>Left</em>: Bar chart of frequencies. <em>Right</em>: Bar chart of relative frequencies (%).
</p>
</div>

<div class="note">
Note how <code>dplyr</code> functions can be expressed sequentially using the forward pipe operator <code>%&gt;%</code>, whereas <code>ggplot2</code> layers have to be added using <code>+</code>!
</div>

<p>Now we can see that properties zoned as residential low density make up nearly 80% of all observations . We also see that properties zoned as agricultural (<code>A_agr</code>), industrial (<code>I_all</code>), commercial (<code>C_all</code>), and residential high density make up a very small amount of observations. In fact, below we see that these imbalanced category levels each make up less than 1% of all observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(MS_Zoning) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(pct)
## # A tibble: 7 x 3
##   MS_Zoning                        n      pct
##   &lt;fct&gt;                        &lt;int&gt;    &lt;dbl&gt;
## 1 A_agr                            2 0.000683
## 2 I_all                            2 0.000683
## 3 C_all                           25 0.00853 
## 4 Residential_High_Density        27 0.00922 
## 5 Floating_Village_Residential   139 0.0474  
## 6 Residential_Medium_Density     462 0.158   
## 7 Residential_Low_Density       2273 0.776</code></pre></div>
<p>Severely imbalanced categories can cause problems in statistical modelling, so it makes sense to sometimes combine the infrequent levels into an <code>other</code> category. An easy way to accomplish this is to use <code>fct_lump()</code><a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>. Here we use <code>n = 2</code> to retain the top two most frequent categories/levels, and condense the remaining into an <code>other</code> category. You can see that <code>other</code> still represents less than 10% of all observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">MS_Zoning =</span> forcats<span class="op">::</span><span class="kw">fct_lump</span>(MS_Zoning, <span class="dt">n =</span> <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(MS_Zoning) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">reorder</span>(MS_Zoning, pct), pct)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-bar-chart-03"></span>
<img src="abar_files/figure-html/04-bar-chart-03-1.png" alt="Bar chart with collapsed categorical levels." width="70%" />
<p class="caption">
Figure 2.13: Bar chart with collapsed categorical levels.
</p>
</div>
<p>In some cases, the categories of a categorical variable have a natural ordering (though, the difference between any two categories is not meaningful)—these are called <em>ordinal</em> variables. For example, the <code>Kitchen_Qual</code> variable in <code>ames</code> categorizes kitchen quality into five buckets:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(ames<span class="op">$</span>Kitchen_Qual)
## 
## Excellent      Fair      Good      Poor   Typical 
##       205        70      1160         1      1494</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Kitchen_Qual)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-kitchen-quality-02"></span>
<img src="abar_files/figure-html/04-kitchen-quality-02-1.png" alt="Bar chart inadequately capturing ordinal levels." width="70%" />
<p class="caption">
Figure 2.14: Bar chart inadequately capturing ordinal levels.
</p>
</div>
<p>Here, we might consider ordering the bars using their natural order: <code>Poor</code> &lt; <code>Fair</code> &lt; <code>Typical</code> &lt; <code>Good</code> &lt; <code>Excellent</code>. One way to plot the categories in a particular order is to use <code>forcats::fct_relevel()</code>. From Figure <a href="visualization.html#fig:04-kitchen-quality-03">2.15</a>, it is easier to see that most homes have average to slightly above average quality kitchens.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Kitchen_Qual =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(
    Kitchen_Qual, <span class="st">&quot;Poor&quot;</span>, <span class="st">&quot;Fair&quot;</span>, <span class="st">&quot;Typical&quot;</span>, <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Excellent&quot;</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Kitchen_Qual)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-kitchen-quality-03"></span>
<img src="abar_files/figure-html/04-kitchen-quality-03-1.png" alt="Bar chart adequately capturing ordinal levels." width="70%" />
<p class="caption">
Figure 2.15: Bar chart adequately capturing ordinal levels.
</p>
</div>
<p>Often our data will have categorical variables that are numerically encoded (typically as integers). For example, in the <code>ames</code> data set, the month each home was sold (<code>Mo_Sold</code>) was encoded using the integers 1–12. For visual (and in some cases, modelling), we will want to make sure R treats such variables as categorical. This is easiest to accomplish using <code>as.factor()</code>. The following example demonstrates the difference; the results are displayed in Figure <a href="visualization.html#fig:04-month-sold">2.16</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Keeping Mo_Sold as an integer</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(Mo_Sold)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month sold (numeric)&quot;</span>)

<span class="co"># Converting Mo_Sold to a factor</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="kw">as.factor</span>(Mo_Sold))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Month sold (factor)&quot;</span>)

<span class="co"># Display both plots side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">nrow =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-month-sold"></span>
<img src="abar_files/figure-html/04-month-sold-1.png" alt="Bar chart of `Mo_Sold`. *Top*: Numeric. *Bottom*: Factor." width="70%" />
<p class="caption">
Figure 2.16: Bar chart of <code>Mo_Sold</code>. <em>Top</em>: Numeric. <em>Bottom</em>: Factor.
</p>
</div>
</div>
<div id="dot-plots" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Dot plots</h4>
<p>Basic bar charts are great when the number of categories is small. As the number of categories increases, the bars can become squished together and distract attention from the main insights of the visual. Cleveland dot plots (or just dot plots) and <em>lollipop</em> charts, like bar charts, are useful for visualizing discrete distributions (e.g., tables or the frequencies of different categories) while being more economical in ink.</p>
<p>For example, if we can use <code>geom_point()</code> to construct a dot plot of the relative frequencies of home sales across the 28 within the Ames housing data set. The result is displayed on the left side of Figure <a href="visualization.html#fig:04-dot-plot-03">2.17</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p1 &lt;-<span class="st"> </span>ames <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span><span class="kw">count</span>(Neighborhood) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(pct, <span class="kw">reorder</span>(Neighborhood, pct))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Relative frequency&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Neighborhood&quot;</span>)</code></pre></div>
<p>Similar to a dot plot, a lollipop chart minimizes the visual ink but uses a line to draw the readers attention to the specific <span class="math inline">\(x\)</span>-axis value of each category. To create a lollipop chart, we use <code>geom_segment()</code> to add lines to the previous plot; we explicitly state that we want the lines to start at <code>x = 0</code> and extend to the corresponding relative frequency with <code>xend = pct</code>. We also need to include <code>y = Neighborhood</code> and <code>yend = Neighborhood</code> so that we get one line segment for each neighborhood. The result is displayed on the right side of Figure <a href="visualization.html#fig:04-dot-plot-03">2.17</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p2 &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">xend =</span> pct, <span class="dt">y =</span> Neighborhood, <span class="dt">yend =</span> Neighborhood),
               <span class="dt">size =</span> <span class="fl">0.15</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-dot-plot-03"></span>
<img src="abar_files/figure-html/04-dot-plot-03-1.png" alt="Relative frequency of home sales accross the different neighborhoods. *Left*: Dot plot. *Right*: Lollipop chart." width="100%" />
<p class="caption">
Figure 2.17: Relative frequency of home sales accross the different neighborhoods. <em>Left</em>: Dot plot. <em>Right</em>: Lollipop chart.
</p>
</div>
</div>
<div id="pie-charts" class="section level4">
<h4><span class="header-section-number">2.2.2.3</span> Pie charts</h4>
<p>Don’t use them.</p>
</div>
</div>
</div>
<div id="bivariate-data" class="section level2">
<h2><span class="header-section-number">2.3</span> Bivariate data</h2>
<p>Beyond understanding the distribution of each individual variable, we often want to investigate associations and relationships between variables. When visualizing the relationship between two or more variables we are generally interested in identifying potential associations, outliers, clusters, gaps, barriers, and change points.</p>
<div id="scatter-plots" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Scatter plots</h3>
<p>The easiest way to assess the relationship between two continuous variables is to use a scatter plot, one of the most important statistical graphics. A scatter plot graphs two continuous variables directly against each other (one variable on each axis).</p>
<p>In this section, we’ll use the <code>geom_point()</code> function—<code>ggplot2</code>’s function for producing scatter plots. In the code chunk below, we use <code>geom_point()</code> to obtain a plot of sale price (<code>Sale_Price</code>) versus the square footage of above ground living area (<code>Gr_Liv_Area</code>). To limit the effect of <em>over plotting</em>, a common issue with scatter plot of large data sets, we lower the opacity of the individual points using <code>alpha = 0.3</code><a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Gr_Liv_Area, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>)  <span class="co"># lower opacity</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-scatter-01"></span>
<img src="abar_files/figure-html/04-scatter-01-1.png" alt="Scatter plot of Sale_Price and Gr_Liv_Area." width="70%" />
<p class="caption">
Figure 2.18: Scatter plot of Sale_Price and Gr_Liv_Area.
</p>
</div>
<p>It is fairly evident from Figure <a href="visualization.html#fig:04-scatter-01">2.18</a> that there is a generally positive association between <code>Gr_Liv_Area</code> and <code>Sale_Price</code> (this <strong>does not</strong> imply any <em>causal association</em> between them). Five potential outliers with <code>Gr_liv_Area &gt; 4000</code> are also apparent. We also gain a general understanding of the <em>joint density</em> of these two variables (e.g., dense regions/clusters of data points indicate reasonable combinations of <code>Gr_liv_Area</code> and <code>Sale_Price</code>.) For example, it is not very likely to find a home that will sell for more than $400K that less than 1.5K (sq. ft.) of above ground living area.</p>
<!-- - **clusters**: Give the large number of points there is a lot of overplotting, which is why we incorporated `alpha = 0.3` to increase transparency. This allows us to see the clustering of data points in the center of the variable relationship; -->
<!-- - **barriers**: the outer limits of our point clustering shows us that there are limitations on the sale price for given ranges of square footage. For example, homes with less than 1,000 square feet above ground appear to have a price ceiling of \$200,000 or less. -->
<p>The relationship between <code>Gr_Liv_Area</code> and <code>Sale_Price</code> appears to be fairly linear, but the variability in <code>Sale_Price</code> increases with <code>Gr_Liv_Area</code> (probably due to the positive skewness associated with both variables); this non-constant variance is called <em>heteroscedasticiy</em> and we will revisit this topic briefly in section <strong>[REFERNCE LINEAR REGRESSION SECTION]</strong>. To help guide our eyes in interpreting trends between two variables, we can add parametric and/or non-parametric trend lines. In Figure <a href="visualization.html#fig:04-scatter-02">2.19</a>, we use <code>geom_smooth()</code> to add two different trend lines:</p>
<ul>
<li><p><code>method = &quot;lm&quot;</code> draw a trend line of the form <span class="math inline">\(\beta_0 + \beta_1\)</span><code>Gr_Liv_Area</code>, where the <span class="math inline">\(y\)</span>-intercept (<span class="math inline">\(\beta_0\)</span>) and the slope (<span class="math inline">\(\beta_1\)</span>) are estimated from the observed data;</p></li>
<li><p><code>method = &quot;auto&quot;</code> use the number of observations to choose an appropriate non-parametric smoother (i.e., let the trend be dictated by the observed data).</p></li>
</ul>
<p>Note that for both trend lines we used <code>se = FALSE</code> to suppress plotting +/-2 standard error bands. Figure <a href="visualization.html#fig:04-scatter-02">2.19</a> shows that for homes with less than 2,250 square feet the relationship is fairly linear; however, beyond 2,250 square feet we see strong deviations from linearity. For reference, we also included the same plot, but with both axes on the <span class="math inline">\(log_{10}\)</span> scale. Notice how this transformation helps to alleviate, to some extent, the heteroskedacticy noted earlier.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Better colors for the trend lines</span>
set1 &lt;-<span class="st"> </span>RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dt">n =</span> <span class="dv">9</span>, <span class="dt">name =</span> <span class="st">&quot;Set1&quot;</span>)

<span class="co"># Scatter plot with trend lines</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Gr_Liv_Area, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> set1[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;auto&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> set1[<span class="dv">2</span>])

<span class="co"># Scatter plot with trend lines (log10 scale)</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Gr_Liv_Area, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> set1[<span class="dv">1</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;auto&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> set1[<span class="dv">2</span>]) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()

<span class="co"># Display plots side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-scatter-02"></span>
<img src="abar_files/figure-html/04-scatter-02-1.png" alt="Illustrating linear versus nonlinear relationships in scatter plots." width="70%" />
<p class="caption">
Figure 2.19: Illustrating linear versus nonlinear relationships in scatter plots.
</p>
</div>
<p>Although we can overcome the issue of over plotting to some extent by lowering the opacity of each individual point, this is often not enough. We can go a step beyond by adding a 2-D kernel density estimate (KDE) using <code>stat_density_2d()</code>, or grouping points into hexagonal bins and displaying a heat map of the bin counts using <code>geom_hex()</code>. Each of these are illustrated in Figure <a href="visualization.html#fig:04-scatter-03">2.20</a> which graphs <code>Sale_Price</code> versus <code>Garage_Area</code>. By incorporating a 2-D KDE (middle) we draw attention to the higher density areas which appear to be located at homes with <code>Garage_Area = 0</code>, and homes where <code>250 &lt; Garage_Area &lt; 500</code>. Similar observations can be drawn from the hexagonal heat map (right).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Scatter plot</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Garage_Area, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>)

<span class="co"># Scatter plot with 2-D KDE</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Garage_Area, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_density2d</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> <span class="kw">stat</span>(level)), <span class="dt">geom =</span> <span class="st">&quot;polygon&quot;</span>) <span class="op">+</span>
<span class="st">  </span>viridis<span class="op">::</span><span class="kw">scale_fill_viridis</span>(<span class="dt">option =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)

<span class="co"># heat map of hexagonal bin counts</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Garage_Area, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">50</span>, <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span>viridis<span class="op">::</span><span class="kw">scale_fill_viridis</span>(<span class="dt">option =</span> <span class="st">&quot;D&quot;</span>)  <span class="co"># &quot;D&quot; is the default</span>

<span class="co"># Display plots side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, p3, <span class="dt">ncol =</span> <span class="dv">3</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-scatter-03"></span>
<img src="abar_files/figure-html/04-scatter-03-1.png" alt="Avoiding over plotting in scatter plots. *Left*: scatter plot with transparent points. *Middle*: transparent points with 2-D KDE. *Right*: heat map of hexagonal bin counts." width="70%" />
<p class="caption">
Figure 2.20: Avoiding over plotting in scatter plots. <em>Left</em>: scatter plot with transparent points. <em>Middle</em>: transparent points with 2-D KDE. <em>Right</em>: heat map of hexagonal bin counts.
</p>
</div>
<p>A scatter plot of a continuous variable against a categorical variable is referred to as a <em>strip plot</em>. Strip plots can be useful in practice, but it is generally advisable to use box plots (and there extensions) instead. Below we plot <code>Sale_Price</code> against the number of above ground bedrooms (<code>Bedroom_AbvGr</code>). Due to the size of this data set, the strip plot (top left) suffers from over plotting. We can use <code>geom_jitter()</code> to add a some random variation to points within each category (top right), which allows us to see where heavier concentrations of points exist. Alternatively, we can use box plots and violin plots to compare the distributions of <code>Sale_Price</code> to <code>Bedroom_AbvGr</code> (bottom row).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Convert to an ordered factor</span>
ames<span class="op">$</span>Bedroom_AbvGr &lt;-<span class="st"> </span><span class="kw">as.ordered</span>(ames<span class="op">$</span>Bedroom_AbvGr)

<span class="co"># Strip plot</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Bedroom_AbvGr, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>)

<span class="co"># Strip plot (with jittering)</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Bedroom_AbvGr, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">width =</span> <span class="fl">0.2</span>)

<span class="co"># Box plots</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Bedroom_AbvGr, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()

<span class="co"># Violin plots</span>
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Bedroom_AbvGr, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>()

<span class="co"># Display plots side by side</span>
<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">nrow =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-comparing-groups"></span>
<img src="abar_files/figure-html/04-comparing-groups-1.png" alt="Comparing a continuous variable accross groups. *Top left*: scatter plot. *Top right*: strip plots. *Bottom left*: box plots. *Bottom right*: violin plots." width="100%" />
<p class="caption">
Figure 2.21: Comparing a continuous variable accross groups. <em>Top left</em>: scatter plot. <em>Top right</em>: strip plots. <em>Bottom left</em>: box plots. <em>Bottom right</em>: violin plots.
</p>
</div>

<div class="tip">
When constructing box plots of a continuous variable within different groups of a factor, it is sometimes useful to use <em>notched box plots</em> (at least from a comparative statistical inference perspective). Whenever <code>notch = TRUE</code>, a “notch” is drawn on both sides of each box. If the notches of any two box plots do not overlap, this is evidence that the medians differ; see <code>?boxplot</code> for details and a reference. An example is displayed in Figure <a href="visualization.html#fig:04-notched-box-plot">2.22</a> comparing <code>Sale_Price</code> across homes of varying quality (<code>Overall_Qual</code>).
</div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Overall_Qual, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">notch =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-notched-box-plot"></span>
<img src="abar_files/figure-html/04-notched-box-plot-1.png" alt="Notched box plots comparing `Sale_Price` across homes of varying quality (`Overall_Qual`)." width="100%" />
<p class="caption">
Figure 2.22: Notched box plots comparing <code>Sale_Price</code> across homes of varying quality (<code>Overall_Qual</code>).
</p>
</div>
<p>Box plots and violin plots are an effective way to visualize distributional differences in a continuous variable accross groups. A popular alternative is to use what are called <em>ridge plots</em> (formerly known as <em>joy plots</em>). These plots can be constructed easily using the <code>ggridges::geom_density_ridges()</code> function, as shown below; the results are displayed in Figure <a href="visualization.html#fig:04-ridge-plot">2.23</a>.</p>
<!-- Plotting the KDE of a continuous variable within each group can also be an effective way to see how groups differ. For example, we could assess the `Sale_Price` of homes across the overall quality of homes. We can do this with a frequency polygon (left), which display the outline of a histogram. However, since some quality levels have very low counts it is tough to see the distribution of costs within each category. A better approach is to overlay density plots which allows us to see how each quality level's distribution differs from one another.  -->
<!-- ```{r, fig.width=8, fig.height=5, fig.cap="Overlaying density plots."} -->
<!-- p1 <- ggplot(ames, aes(x = Sale_Price, color = Overall_Qual)) + -->
<!--   geom_freqpoly() + -->
<!--   scale_x_log10(breaks = c(50, 150, 400, 750) * 1000, labels = dollar) -->
<!-- p2 <- ggplot(ames, aes(x = Sale_Price, color = Overall_Qual, fill = Overall_Qual)) + -->
<!--   geom_density(alpha = .15) + -->
<!--   scale_x_log10(breaks = c(50, 150, 400, 750) * 1000, labels = dollar) -->
<!-- grid.arrange(p1, p2, nrow = 2) -->
<!-- ``` -->
<!-- When there are many levels in a categorical variable, overlaid plots become difficult to decipher. Rather than overlay plots, we can also use small multiples to compare the distribution of a continuous variable. Ridge plots provide a form of small multiples by partially overlapping distribution plots. They can be quite useful for visualizing changes in continuous distributions over discrete variable levels. In this example we use the `ggri` package which provides an add-on `geom_joy` for `ggplot2`. Now we get a much clearer picture how the sales price differs for each quality level. -->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Sale_Price, <span class="dt">y =</span> Overall_Qual)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>ggridges<span class="op">::</span><span class="kw">geom_density_ridges</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">labels =</span> dollar)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-ridge-plot"></span>
<img src="abar_files/figure-html/04-ridge-plot-1.png" alt="Ridge plot comparing `Sale_Price` across homes of varying quality (`Overall_Qual`)." width="70%" />
<p class="caption">
Figure 2.23: Ridge plot comparing <code>Sale_Price</code> across homes of varying quality (<code>Overall_Qual</code>).
</p>
</div>
</div>
</div>
<div id="multivariate-data" class="section level2">
<h2><span class="header-section-number">2.4</span> Multivariate data</h2>
<div id="fixme-this-section-still-needs-cleaned-up-a-bit." class="section level4">
<h4><span class="header-section-number">2.4.0.1</span> FIXME: This section still needs cleaned up a bit.</h4>
<p>More often than not, we are interested in visualizing the relationship between two or more variables. In the Ames housing data, for example, we might be interested in visualizing the relationship between <code>Sale_Price</code> and <code>Overall_Qual</code>. The nature of each variable (i.e., continuous or categorical) will often dictate the appropriate type of graphic to use. We start with the simplest case, where we want to visualize the relationship (if any) between two continuous variables.</p>
</div>
<div id="facetting" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Facetting</h3>
<p>Data are usually multivariate by nature, and the many analytic techniques are designed to capture multivariate relationships. Visual exploration should therefore also incorporate this important aspect. Although we have shown how to visualize one or two variables at a time, we can go a step beyond by adding information about additional variables using color, shape, size, etc.</p>
<p>In Figure <a href="visualization.html#fig:04-scatter-01">2.18</a>, we compared <code>Sale_Price</code> with <code>Gr_Liv_Area</code> using a simple scatter plot. We can also include information on other variables by using color, shape, and point size. For instance, we can use a different point shape and color to indicate homes with and without central air conditioning (<code>Central_Air</code>). Figure <a href="visualization.html#fig:04-facet-01">2.24</a> illustrates that there are far more homes with central air; furthermore, the homes without central air tend to have less square footage and lower sale prices. <!-- (**Note**: we used a $log_{10}$ for each variable to correct for the positive skewness of both variables.) --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Gr_Liv_Area, <span class="dt">y =</span> Sale_Price, 
                 <span class="dt">color =</span> Central_Air, <span class="dt">shape =</span> Central_Air)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st">  </span><span class="co"># lower the opacity of each point</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-facet-01"></span>
<img src="abar_files/figure-html/04-facet-01-1.png" alt="Scatter plot of `Sale_Price` and `Gr_Liv_Area` colored and shaped by `Central_Air`." width="70%" />
<p class="caption">
Figure 2.24: Scatter plot of <code>Sale_Price</code> and <code>Gr_Liv_Area</code> colored and shaped by <code>Central_Air</code>.
</p>
</div>
<p>Although we lowered the opacity of each point (using <code>alpha = 0.5</code>), the over crowded plot makes it difficult to distinguish the relationships between homes with and without air conditioning. Another approach is to use <em>facetting</em> (i.e., plot each category in its own panel). In <code>ggplot2</code>, we have two options: <code>facet_wrap()</code> for a 1-D ribbon of 2-D panels, and <code>facet_grid()</code> to form a particular matrix of panels. For this problem, we’ll use the former:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Gr_Liv_Area, <span class="dt">y =</span> Sale_Price, 
                 <span class="dt">color =</span> Central_Air, <span class="dt">shape =</span> Central_Air)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st">  </span><span class="co"># lower the opacity of each point</span>
<span class="st">  </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>Central_Air)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-facet-02"></span>
<img src="abar_files/figure-html/04-facet-02-1.png" alt="Scatter plot of `Sale_Price` and `Gr_Liv_Area` colored and shaped by `Central_Air`." width="70%" />
<p class="caption">
Figure 2.25: Scatter plot of <code>Sale_Price</code> and <code>Gr_Liv_Area</code> colored and shaped by <code>Central_Air</code>.
</p>
</div>
<p>However, as before, when there are many levels in a categorical variable it becomes hard to compare differences by only incorporating color or shape features. An alternative is to create small multiples. Below we compare the relationship between <code>Sale_Price</code> and <code>Gr_Liv_Area</code> and how this relationship differs across the different house styles (<code>House_Style</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Gr_Liv_Area, <span class="dt">y =</span> Sale_Price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>House_Style, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-facet-03"></span>
<img src="abar_files/figure-html/04-facet-03-1.png" alt="Using small multiples to assess three dimensions in a scatter plot." width="70%" />
<p class="caption">
Figure 2.26: Using small multiples to assess three dimensions in a scatter plot.
</p>
</div>
<p>We can start to add several of the features discussed in this chapter to highlight multivariate features. For example, here we assess the relationship between sales price and above ground square footage for homes with and without central air conditioning and across the different housing styles. For each house style and central air category we can see where the values are clustered and how the linear relationship changes. For all home styles, houses with central air have a higher selling price with a steeper slope than those without central air. Also, those plots without density markings and linear lines for the no central air category (red) tell us that there are no more than one observation in these groups; so this identifies gaps across multivariate categories of interest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ames, <span class="kw">aes</span>(<span class="dt">x =</span> Gr_Liv_Area, <span class="dt">y =</span> Sale_Price, <span class="dt">color =</span> Central_Air, <span class="dt">shape =</span> Central_Air)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density2d</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">labels =</span> dollar) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>House_Style, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Sale Price vs. Above Ground Sq.Ft&quot;</span>,
          <span class="dt">subtitle =</span> <span class="st">&quot;How does central air and house style influence this relationship?&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-facet-04"></span>
<img src="abar_files/figure-html/04-facet-04-1.png" alt="Combining multiple attributes." width="70%" />
<p class="caption">
Figure 2.27: Combining multiple attributes.
</p>
</div>
<p>We can also use faceting (i.e., <code>facet_wrap()</code> and <code>facet_grid()</code>) to understand how two or more categorical variables are associated with each other. For example, below we assess the quality of kitchens (<code>Kitchen_Qual</code>) for homes that sold above average (i.e., <code>Sale_Price &gt; mean(Sale_Price)</code>) below average (i.e., <code>Sale_Price &gt; mean(Sale_Price)</code>). Not surprisingly, we see that that sold for above average tended to have higher quality kitchens (Figure <a href="visualization.html#fig:04-facet-05">2.28</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">Group =</span> <span class="kw">ifelse</span>(
      Sale_Price <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sale_Price), <span class="dt">yes =</span> <span class="st">&quot;Sold above avg.&quot;</span>, 
      <span class="dt">no =</span> <span class="st">&quot;Sold below avg.&quot;</span>),
    <span class="dt">Kitchen_Qual =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(
      Kitchen_Qual, <span class="st">&quot;Poor&quot;</span>, <span class="st">&quot;Fair&quot;</span>, <span class="st">&quot;Typical&quot;</span>, <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Excellent&quot;</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Kitchen_Qual)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>Group)
p</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-facet-05"></span>
<img src="abar_files/figure-html/04-facet-05-1.png" alt="Kitchen quality for homes that sold below average (left panel) and above average (right panel)." width="70%" />
<p class="caption">
Figure 2.28: Kitchen quality for homes that sold below average (left panel) and above average (right panel).
</p>
</div>
<p>Figure <a href="visualization.html#fig:04-facet-06">2.29</a> builds onto Figure <a href="visualization.html#fig:04-facet-05">2.28</a> using <code>facet_grid()</code>. In this example, we assess kitchen quality for homes that sold below average and above average across the different neighborhoods. <!-- This plot allows us to see gaps across the different categorical levels along with which category combinations are most frequent. --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">Group =</span> <span class="kw">ifelse</span>(
      Sale_Price <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sale_Price), <span class="dt">yes =</span> <span class="st">&quot;Sold above avg.&quot;</span>, 
      <span class="dt">no =</span> <span class="st">&quot;Sold below avg.&quot;</span>),
    <span class="dt">Kitchen_Qual =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(
      Kitchen_Qual, <span class="st">&quot;Poor&quot;</span>, <span class="st">&quot;Fair&quot;</span>, <span class="st">&quot;Typical&quot;</span>, <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Excellent&quot;</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Neighborhood, Group, Kitchen_Qual) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Kitchen_Qual, pct)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(Neighborhood <span class="op">~</span><span class="st"> </span>Group) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">strip.text.y =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="dv">0</span>))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-facet-06"></span>
<img src="abar_files/figure-html/04-facet-06-1.png" alt="Kitchen quality for homes that sold below average (left panel) and above average (right panel) across the different neighborhoods." width="70%" />
<p class="caption">
Figure 2.29: Kitchen quality for homes that sold below average (left panel) and above average (right panel) across the different neighborhoods.
</p>
</div>
<div id="parallel-coordinate-plots" class="section level4">
<h4><span class="header-section-number">2.4.1.1</span> Parallel coordinate plots</h4>
<p>Parallel coordinate plots (PCPs) are also a great way to visualize continuous variables across multiple variables. In PCPs, a vertical axis is drawn for each variable. Then each observation is represented by drawing a line that connects its values on the different axis, creating a multivariate profile. To create a PCP, we can use the <code>GGally::ggparcoord()</code> function. By default, <code>GGally::ggparcoord()</code> will standardize the variables based on a <span class="math inline">\(z\)</span>-score distribution; however, there are many options for scaling (see <code>?GGally::ggparcoord</code>). A benefit of using PCPs is that you can visualize observations across both continuous and categorical variables. In the example below we include <code>Overall_Qual</code>, an ordered factor with ten levels <code>&quot;Very Poor&quot; &lt; &quot;Poor&quot; &lt; &quot;Fair&quot; &lt; ... &lt; &quot;Excellent&quot; &lt; &quot;Very Excellent&quot;</code> having integer values of 1–10. When including a factor variable, <code>GGally::ggparcoord()</code> will use the factor integer levels as their corresponding value, so it is important to appropriately order any factors you want to include.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Variables of interest</span>
variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Sale_Price&quot;</span>, <span class="st">&quot;Year_Built&quot;</span>, <span class="st">&quot;Year_Remod_Add&quot;</span>, <span class="st">&quot;Overall_Qual&quot;</span>)

<span class="co"># Parallel coordinate plot</span>
ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(variables) <span class="op">%&gt;%</span>
<span class="st">  </span>GGally<span class="op">::</span><span class="kw">ggparcoord</span>(<span class="dt">alpha =</span> <span class="fl">0.05</span>, <span class="dt">scale =</span> <span class="st">&quot;center&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-pcp-01"></span>
<img src="abar_files/figure-html/04-pcp-01-1.png" alt="Parallel coordinate plot." width="70%" />
<p class="caption">
Figure 2.30: Parallel coordinate plot.
</p>
</div>
<p>The darker bands in the above plot illustrate several features. The observations with higher sales prices tend to be built in more recent years, be remodeled in recent years and be categorized in the top half of the overall quality measures. In contracts, homes with lower sales prices tend to be more out-dated (based on older built and remodel dates) and have lower quality ratings. We also see some homes with exceptionally old build dates that have much newer remodel dates but still have just average quality ratings.</p>
<p>We can make this more explicit by adding a new variable to indicate if a sale price is above average. We can then tell <code>GGally::ggparcood()</code> to group by this new variable. Now we clearly see that above average sale prices are related to much newer homes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(variables) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Above_Avg =</span> Sale_Price <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sale_Price)) <span class="op">%&gt;%</span>
<span class="st">  </span>GGally<span class="op">::</span><span class="kw">ggparcoord</span>(
    <span class="dt">alpha =</span> <span class="fl">0.05</span>,
    <span class="dt">scale =</span> <span class="st">&quot;center&quot;</span>,
    <span class="dt">columns =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,
    <span class="dt">groupColumn =</span> <span class="st">&quot;Above_Avg&quot;</span>
  )</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-pcp-02"></span>
<img src="abar_files/figure-html/04-pcp-02-1.png" alt="Refined parallel coordinate plot." width="70%" />
<p class="caption">
Figure 2.31: Refined parallel coordinate plot.
</p>
</div>
</div>
<div id="mosaic-plots" class="section level4">
<h4><span class="header-section-number">2.4.1.2</span> Mosaic plots</h4>
<p>Mosaic plots are a graphical method for visualizing data from two or more qualitative variables. In this visual the graphics area is divided up into rectangles proportional in size to the counts of the combinations they represent.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames2 &lt;-<span class="st"> </span>ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">Above_Avg =</span> Sale_Price <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sale_Price),
    <span class="dt">Garage_Type =</span> <span class="kw">abbreviate</span>(Garage_Type),
    <span class="dt">Garage_Qual =</span> <span class="kw">abbreviate</span>(Garage_Qual)
  )

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw">mosaicplot</span>(Above_Avg <span class="op">~</span><span class="st"> </span>Garage_Type, <span class="dt">data =</span> ames2, <span class="dt">las =</span> <span class="dv">1</span>)
<span class="kw">mosaicplot</span>(Above_Avg <span class="op">~</span><span class="st"> </span>Garage_Type <span class="op">+</span><span class="st"> </span>Garage_Cars, <span class="dt">data =</span> ames2, <span class="dt">las =</span> <span class="dv">1</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mosaic"></span>
<img src="abar_files/figure-html/mosaic-1.png" alt="Mosaic plot." width="70%" />
<p class="caption">
Figure 2.32: Mosaic plot.
</p>
</div>
</div>
<div id="tree-maps" class="section level4">
<h4><span class="header-section-number">2.4.1.3</span> Tree maps</h4>
<p>Tree maps are also a useful visualization aimed at assessing the hierarchical structure of data. Tree maps are primarily used to assess a numeric value across multiple categories. It can be useful to assess the counts or proportions of a categorical variable nested within other categorical variables. For example, we can use a tree map to visualize the above right mosaic plot that illustrates the number of homes sold above and below average sales price with different garage characteristics. We can see in the tree map that houses with above average prices tend to have attached 2 and 3-car garages. Houses sold below average price have more attached 1-car garages and also have far more detached garages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Above_Below =</span> <span class="kw">ifelse</span>(Sale_Price <span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(Sale_Price), <span class="st">&quot;Above Avg&quot;</span>, <span class="st">&quot;Below Avg&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(Garage_Type, Garage_Cars, Above_Below) <span class="op">%&gt;%</span>
<span class="st">  </span>treemap<span class="op">::</span><span class="kw">treemap</span>(
    <span class="dt">index =</span> <span class="kw">c</span>(<span class="st">&quot;Above_Below&quot;</span>, <span class="st">&quot;Garage_Type&quot;</span>, <span class="st">&quot;Garage_Cars&quot;</span>),
    <span class="dt">vSize =</span> <span class="st">&quot;n&quot;</span>
  )</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-tree-map-01"></span>
<img src="abar_files/figure-html/04-tree-map-01-1.png" alt="Treemaps to illustrate hierarchical structures." width="70%" />
<p class="caption">
Figure 2.33: Treemaps to illustrate hierarchical structures.
</p>
</div>
</div>
<div id="heat-maps" class="section level4">
<h4><span class="header-section-number">2.4.1.4</span> Heat maps</h4>
<p>A <em>heat map</em> is essentially a false color image of a matrix or data set. Heat maps can be extremely useful in identifying clusters of values; a common use is in plotting a correlation matrix (Figure <a href="visualization.html#fig:04-heat-map-01">2.34</a>). In the code chunk below we select all the numeric variables in <code>ames</code>, compute the correlation matrix between them, and visualize the results with a heat map. Bright/dark spots represent clusters of observations with similar correlations. From Figure <a href="visualization.html#fig:04-heat-map-01">2.34</a>, we can see that <code>Sale_Price</code> (3rd row from top) has a relatively weak linear association with variables such as <code>BsmtFin_Sf_1</code>, <code>Bsmt_Unf_SF</code>, <code>Longitude</code>, and <code>Enclosed_Porch</code>. The larger correlations values for <code>Sale_Price</code> align with variables such as <code>Garage_Cars</code>, <code>Garage_Area</code>, and <code>First_Flr_SF</code>, etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select_if</span>(is.numeric) <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># select all the numeric columns</span>
<span class="st">  </span><span class="kw">cor</span>() <span class="op">%&gt;%</span><span class="st">                          </span><span class="co"># compute the correlation matrix</span>
<span class="st">  </span><span class="kw">heatmap</span>(                           
    <span class="dt">symm =</span> <span class="ot">TRUE</span>,                     <span class="co"># since correlation matrices are symmetric!</span>
    <span class="dt">col =</span> viridis<span class="op">::</span><span class="kw">inferno</span>(<span class="kw">nrow</span>(ames))
  )  </code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-heat-map-01"></span>
<img src="abar_files/figure-html/04-heat-map-01-1.png" alt="heat map where yellow represents highly correlated values and red represents weakly correlated values." width="70%" />
<p class="caption">
Figure 2.34: heat map where yellow represents highly correlated values and red represents weakly correlated values.
</p>
</div>
</div>
<div id="generalized-pairs-plot" class="section level4">
<h4><span class="header-section-number">2.4.1.5</span> Generalized pairs plot</h4>
<p>When dealing with a small data set (or subset of a large data set), it can be useful to construct a matrix of plots comparing two-way relationships across a number of variables. In the code chunk below we (i) select <code>Sale_Price</code> and all variables names that contain <code>&quot;sf&quot;</code> (i.e., all square footage variables), (ii) scale all variables, and (iii) display scatter plots and correlation values with the <code>GGally::ggpairs()</code> function. The results are displayed in Figure <a href="visualization.html#fig:04-ggpairs-01">2.35</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Sale_Price, <span class="kw">contains</span>(<span class="st">&quot;sf&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># select column names containing &quot;sf&quot;</span>
<span class="st">  </span>purrr<span class="op">::</span><span class="kw">map_df</span>(scale) <span class="op">%&gt;%</span>
<span class="st">  </span>GGally<span class="op">::</span><span class="kw">ggpairs</span>()</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-ggpairs-01"></span>
<img src="abar_files/figure-html/04-ggpairs-01-1.png" alt="Pairwise scatter plot." width="70%" />
<p class="caption">
Figure 2.35: Pairwise scatter plot.
</p>
</div>
</div>
</div>
</div>
<div id="data-quality" class="section level2">
<h2><span class="header-section-number">2.5</span> Data quality</h2>
<!-- Graphical displays can also assist in summarizing certain data quality features. In the previous sections we illustrated how we can identify outliers but  -->
<p>Data quality is an important issue for any project involving analyzing data. Data quality issues deserves an entire book in its own right, and a good reference is the The Quartz guide to bad data <span class="citation">(“The Quartz Guide to Bad Data,” n.d.)</span>. In this section, we discuss one topic of particular importance: visualizing missing data.</p>
<p>It is important to understand the distribution of missing values (i.e., <code>NA</code>) is any data set. So far, we have been using a pre-processed version of the Ames housing data set (via the <code>AmesHousing::make_ames()</code> function). However, if we use the raw Ames housing data (via <code>AmesHousing::ames_raw</code>), there are actually 13,997 missing values—there is at least one missing values in each row of the original data!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(AmesHousing<span class="op">::</span>ames_raw))
## [1] 13997</code></pre></div>
<p>It is important to understand the distribution of missing values in a data set in order to determine 1) if any variable(s) should be eliminated prior to analysis, or 2) if any values need to be <em>imputed</em><a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a>.</p>
<p>Heat maps are an efficient way to visualize the distribution of missing values for small- to medium-sized data sets. The code <code>is.na(&lt;data-frame-name&gt;)</code> will return a matrix of the same dimension as the given dsta frame, but each cell will contain either <code>TRUE</code> (if the corresponding value is missing) or <code>FALSE</code> (if the corresponding value is not missing). To construct such a plot, we can use R’2 built-in <code>heatmap()</code> or <code>image()</code> functions, or <code>ggplot2</code>’s <code>geom_raster()</code> function, among others; we use <code>geom_raster()</code> below. This allows us to easily see where the majority of missing values occur (i.e., in the variables <code>Alley</code>, <code>Fireplace Qual</code>, <code>Pool QC</code>, <code>Fence</code>, and <code>Misc Feature</code>). Due to their high frequency of missingness, these variables would likely need to be removed prior to statiscial analysis, or imputed (i.e., filled in with intelligent guesses). We can also spot obvious patterns of missingness. For example, missing values appear to occur within the same observations across all garage variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AmesHousing<span class="op">::</span>ames_raw <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">is.na</span>() <span class="op">%&gt;%</span>
<span class="st">  </span>reshape2<span class="op">::</span><span class="kw">melt</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Var2, Var1, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_raster</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_grey</span>(<span class="dt">name =</span> <span class="st">&quot;&quot;</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Present&quot;</span>, <span class="st">&quot;Missing&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.text.y  =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">4</span>))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-heat-map-02"></span>
<img src="abar_files/figure-html/04-heat-map-02-1.png" alt="Heat map of ,issing values in the raw Ames housing data." width="100%" />
<p class="caption">
Figure 2.36: Heat map of ,issing values in the raw Ames housing data.
</p>
</div>
<p>Digging a little deeper into these variables, we might notice that <code>Garage_Cars</code> and <code>Garage_Area</code> contain the value <code>0</code> whenever the other <code>Garage_xx</code> variables have missing values (i.e. a value of <code>NA</code>). This might be because they did not have a way to identify houses with no garages when the data were originally collected; and therefore, all houses with no garage were identified by including nothing. Since this missingness is informative, it would be appropriate to impute <code>NA</code> with a new category level (e.g., <code>&quot;None&quot;</code>) for these garage variables. Circumstances like this tend to only arise upon careful descriptive and visual examination of the data!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">AmesHousing<span class="op">::</span>ames_raw <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(<span class="st">`</span><span class="dt">Garage Type</span><span class="st">`</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&quot;garage&quot;</span>))
## # A tibble: 157 x 7
##    `Garage Type` `Garage Yr Blt` `Garage Finish` `Garage Cars`
##    &lt;chr&gt;                   &lt;int&gt; &lt;chr&gt;                   &lt;int&gt;
##  1 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  2 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  3 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  4 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  5 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  6 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  7 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  8 &lt;NA&gt;                       NA &lt;NA&gt;                        0
##  9 &lt;NA&gt;                       NA &lt;NA&gt;                        0
## 10 &lt;NA&gt;                       NA &lt;NA&gt;                        0
## # ... with 147 more rows, and 3 more variables: `Garage Area` &lt;int&gt;,
## #   `Garage Qual` &lt;chr&gt;, `Garage Cond` &lt;chr&gt;</code></pre></div>
<p>The <code>visna()</code> function in R package <code>extracat</code> <span class="citation">(Pilhoefer <a href="#ref-R-extracat">2018</a>)</span> allows for easy visualization of missing data patterns. We illustrate this functionality below using the raw Ames housing data (Figure @ref(fig: 04-missingness-02)). The columns of the heat map represent the 82 variables of the raw data and the rows represent the observations. By default, missing values (i.e., <code>NA</code>) are inidcated via a blue cell. The variables and patterns have been ordered by the number of <code>NA</code>s on both rows and columns (i.e., <code>sort = &quot;b&quot;</code>). The bars beneath the columns show the proportion of <code>NA</code>s by variable and the bars on the right show the relative frequency of <code>NA</code>s.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">extracat<span class="op">::</span><span class="kw">visna</span>(AmesHousing<span class="op">::</span>ames_raw, <span class="dt">sort =</span> <span class="st">&quot;b&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:04-missingness-02"></span>
<img src="abar_files/figure-html/04-missingness-02-1.png" alt="Visualizing missing patterns" width="70%" />
<p class="caption">
Figure 2.37: Visualizing missing patterns
</p>
</div>
<p>Data can be missing for different reasons. Perhaps the values was never recroded (or lost in trabnslation), or it was recorded an error (a common feature of data enetered by hand). Regardless, it is important to identify and attempt to understand how missing values are distributed across a data set as it can provide insight into how to deal with these observations.</p>
</div>
<div id="further-reading" class="section level2">
<h2><span class="header-section-number">2.6</span> Further reading</h2>
<p>List some good books, like <span class="citation">Cleveland (<a href="#ref-cleveland-visualizing-1993">1993</a>)</span>!</p>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">2.7</span> Exercises</h2>
<p>Coming soon!</p>
<p>Can use this to introduce additional plots/geoms!</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-pkg-lattice">
<p>Sarkar, Deepayan. 2008. <em>Lattice: Multivariate Data Visualization with R</em>. New York: Springer. <a href="http://lmdvr.r-forge.r-project.org" class="uri">http://lmdvr.r-forge.r-project.org</a>.</p>
</div>
<div id="ref-pkg-ggplot2">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org" class="uri">http://ggplot2.org</a>.</p>
</div>
<div id="ref-pkg-plotly">
<p>Sievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2017. <em>Plotly: Create Interactive Web Graphics via ’Plotly.js’</em>. <a href="https://CRAN.R-project.org/package=plotly" class="uri">https://CRAN.R-project.org/package=plotly</a>.</p>
</div>
<div id="ref-frigge-some-1989">
<p>Frigge, Michael, David C. Hoaglin, and Boris Iglewicz. 1989. “Some Implementations of the Boxplot.” <em>The American Statistician</em> 43 (1): 50–54. doi:<a href="https://doi.org/10.2307/2685173">10.2307/2685173</a>.</p>
</div>
<div id="ref-tukey-exploratory-1977">
<p>Tukey, Jonh W. 1977. <em>Exploratory Data Analysis</em>. Addison-Wesley Series in Behavioral Science. Addison-Wesley Publishing Company.</p>
</div>
<div id="ref-R-extracat">
<p>Pilhoefer, Alexander. 2018. <em>Extracat: Categorical Data Analysis and Visualization</em>. <a href="https://CRAN.R-project.org/package=extracat" class="uri">https://CRAN.R-project.org/package=extracat</a>.</p>
</div>
<div id="ref-cleveland-visualizing-1993">
<p>Cleveland, W.S. 1993. <em>Visualizing Data</em>. At&amp;T Bell Laboratories.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>These bounds are approximate since the binning will round to whole numbers (e.g., 12,800 rather than 12,370).<a href="visualization.html#fnref1">↩</a></p></li>
<li id="fn2"><p>The default in <code>ggplot2</code> is to always use 30 bins—which will not be optimal for most problems.<a href="visualization.html#fnref2">↩</a></p></li>
<li id="fn3"><p>Two things to note here: 1) if you want to change the bin width, you need to feed a log or square root transformed number to bin width or, as we did, increase the number of bins using the <code>bins</code> argument; and 2) if you have zeros in your data, use <code>scale_x_continuous(trans = &quot;log1p&quot;)</code>, which adds 1 prior to the log transformation (you cannot take the logarithm of zero!).<a href="visualization.html#fnref3">↩</a></p></li>
<li id="fn4"><p>To learn more about managing factors, see <span class="citation">Wickham and Grolemund (<a href="#ref-wickham-R-2017">2017</a> ch. 15)</span><a href="visualization.html#fnref4">↩</a></p></li>
<li id="fn5"><p>This option can be specified for any of the <code>geom_&lt;geom-name&gt;()</code> functions discussed in this chapter.<a href="visualization.html#fnref5">↩</a></p></li>
<li id="fn6"><p>Imputation essentially just means filling in missing values with an <em>intelligent guess</em>. We do not discuss missing value imputation in this book, but the interested reader is referred to <span class="citation">Buuren (<a href="#ref-van-flexible-2012">2012</a>)</span> and the R package <code>mice</code> <span class="citation">(<span class="citeproc-not-found" data-reference-id="R-mice"><strong>???</strong></span>)</span>.<a href="visualization.html#fnref6">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["abar.pdf", "abar.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
